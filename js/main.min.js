const burgerBtn = document.querySelector('.burger');
const headerNavigation = document.querySelector('.header__navigation');
const headerBackdrop = document.querySelector('.header__backdrop');
const footerNavigation = document.querySelector('.footer__navigation');
const sections = document.querySelectorAll('[data-navigation]');

function calcScrollWidth() {
  let div = document.createElement('div');
  div.style.width = '50px';
  div.style.height = '50px';
  div.style.overflowY = 'scroll';
  div.style.visibility = 'hidden';
  div.style.opacity = '0';

  document.body.appendChild(div);
  let scrollWidth = div.offsetWidth - div.clientWidth;
  div.remove();

  return scrollWidth;
};

let scrollWidth = calcScrollWidth();

burgerBtn.addEventListener('click', () => {
  if (burgerBtn.classList.contains('active')) {
    closeMenu(burgerBtn, headerNavigation, headerBackdrop);
  } else {
    openMenu(burgerBtn, headerNavigation, headerBackdrop);
  }
});

headerBackdrop.addEventListener('click', () => {
  if (burgerBtn.classList.contains('active') & headerNavigation.classList.contains('active')) {
    closeMenu(burgerBtn, headerNavigation, headerBackdrop);
  }
});

function openMenu(burgerBtn, headerNavigation, headerBackdrop) {
  burgerBtn.classList.add('active');
  headerNavigation.classList.add('active');
  headerBackdrop.style.display = 'block';
  document.body.style.paddingRight = `${scrollWidth}px`;
  document.body.style.overflow = 'hidden';
}

function closeMenu(burgerBtn, headerNavigation, headerBackdrop) {
  burgerBtn.classList.remove('active');
  headerNavigation.classList.remove('active');
  headerBackdrop.style.display = 'none';
  document.body.style.paddingRight = `0px`;
  document.body.style.overflow = 'visible';
}

const projectsSwiper = new Swiper('.projects__swiper', {
  allowTouchMove: false,
  navigation: {
    nextEl: '.projects__button-next',
    prevEl: '.projects__button-prev',
  },
  breakpoints: {
    320: {
      slidesPerView: 1,
      spaceBetween: 20
    },
    450: {
      slidesPerView: 1.2,
      spaceBetween: 20,
    },
    550: {
      slidesPerView: 1.5,
      spaceBetween: 20,
    },
    700: {
      slidesPerView: 2,
      spaceBetween: 20,
    },
    800: {
      slidesPerView: 2,
      spaceBetween: 20,
      centeredSlides: false,
    },
    850: {
      slidesPerView: 2.5,
      spaceBetween: 20,
      centeredSlides: false,
    },
    1100: {
      slidesPerView: 3,
      centeredSlides: false
    },
    1250: {
      slidesPerView: 3.5,
      centeredSlides: false
    },
    1500: {
      slidesPerView: 4
    }
  }
});

const examplesSwiper = new Swiper('.examples__swiper', {
  loop: false,
  slidesPerView: 'auto',
  spaceBetween: 54,
  centeredSlides: false,
  allowTouchMove: false,
  centeredSlidesBounds: true,
  slidesPerGroup: 1,
  pagination: {
    el: '.examples__swiper-pagination',
    clickable: true,
  },
  navigation: {
    nextEl: '.examples__button-next',
    prevEl: '.examples__button-prev',
  },
  breakpoints: {
    1300: {
      spaceBetween: 80,
    },
    1500: {
      centeredSlides: true,
      slidesPerView: 3,
      spaceBetween: 80,
    }
  }
});

const resultsSwiper = new Swiper('.results__swiper', {
  loop: false,
  slidesPerView: 1,
  allowTouchMove: false,
  effect: 'flip',
  speed: 1100,
  spaceBetween: 19,
  pagination: {
    el: '.results__swiper-pagination',
    clickable: false,
  },
  navigation: {
    nextEl: '.results__button-next',
    prevEl: '.results__button-prev',
  },
});

const aboutLeaderSwiper = new Swiper('.about-leader__swiper', {
  loop: false,
  slidesPerView: 1,
  allowTouchMove: false,
  speed: 1100,
  autoHeight: true,
  spaceBetween: 40,
  pagination: {
    el: '.about-leader__swiper-pagination',
    clickable: true,
  },
  navigation: {
    nextEl: '.about-leader__swiper-button-next',
    prevEl: '.about-leader__swiper-button-prev',
  },
  breakpoints: {
    400: {
      slidesPerView: 'auto'
    },
    992: {
      spaceBetween: 40
    },
    1400: {
      slidesPerView: 3,
    }
  }
});

// Navigation on webpage
function getSectionScrollTop(navigationAttribute) {
  const section = document.querySelector(`[data-navigation=${navigationAttribute}]`);

  let sectionScrollTop = section.offsetTop;

  if (section.matches('[data-navigation="examples"]')) {
    sectionScrollTop -= 20;
  } else if (section.matches('[data-navigation="records"]')) {
    sectionScrollTop -= 100;
  } else if (section.matches('[data-navigation="advantages"]')) {
    sectionScrollTop -= 20;
  } else if (section.matches('[data-navigation="results"]')) {
    sectionScrollTop += 40;
  } else if (section.matches('[data-navigation="work-format"]')) {
    sectionScrollTop -= 20;
  }

  return sectionScrollTop;
}

function moveToSection(sectionAttribute) {
  let currentPosition = document.documentElement.scrollTop;
  const sectionPosition = getSectionScrollTop(sectionAttribute);

  if (sectionPosition > currentPosition) {

    function animatedScroll(step, time) {

      let timeoutId = setTimeout(function addStep() {
        if (currentPosition <= sectionPosition) {
          currentPosition += step;
          document.documentElement.scrollTo(0, currentPosition);
          timeoutId = setTimeout(addStep, time);
        }
      }, time);
    }

    animatedScroll(40, 1);
  } else {
    
    function animatedScroll(step, time) {

      let timeoutId = setTimeout(function addStep() {
        if (currentPosition >= sectionPosition) {
          currentPosition -= step;
          document.documentElement.scrollTo(0, currentPosition);
          timeoutId = setTimeout(addStep, time);
        }
      }, time);
    }

    animatedScroll(40, 1);
  }
}

headerNavigation.addEventListener('click', (e) => {
  e.preventDefault();

  if (e.target && e.target.matches('[data-navigation-to]')) {
    const sectionAttribute = e.target.getAttribute('data-navigation-to');

    moveToSection(sectionAttribute);
    closeMenu(burgerBtn, headerNavigation, headerBackdrop);
  }
});

footerNavigation.addEventListener('click', (e) => {
  e.preventDefault();

  if (e.target && e.target.matches('[data-navigation-to]')) {
    const sectionAttribute = e.target.getAttribute('data-navigation-to');

    moveToSection(sectionAttribute);
    closeMenu(burgerBtn, headerNavigation, headerBackdrop);
  }
});